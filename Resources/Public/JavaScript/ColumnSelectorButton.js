/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
var __decorate=this&&this.__decorate||function(e,t,o,r){var l,c=arguments.length,s=c<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var n=e.length-1;n>=0;n--)(l=e[n])&&(s=(c<3?l(s):c>3?l(t,o,s):l(t,o))||s);return c>3&&s&&Object.defineProperty(t,o,s),s},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};define(["require","exports","lit","lit/decorators","TYPO3/CMS/Backend/Enum/Severity","TYPO3/CMS/Backend/Severity","TYPO3/CMS/Backend/Modal","TYPO3/CMS/Core/lit-helper","TYPO3/CMS/Core/Ajax/AjaxRequest","TYPO3/CMS/Backend/Notification"],(function(e,t,o,r,l,c,s,n,a,i){"use strict";var d,u,p;Object.defineProperty(t,"__esModule",{value:!0}),a=__importDefault(a),function(e){e.columnSelectors=".t3js-record-column-selector",e.columnSelectorActionsSelector=".t3js-record-column-selector-actions"}(u||(u={})),function(e){e.toggle="select-toggle",e.all="select-all",e.none="select-none"}(p||(p={}));let h=d=class extends o.LitElement{constructor(){super(),this.title="Show columns",this.ok=n.lll("button.ok")||"Update",this.close=n.lll("button.close")||"Close",this.error="Could not update columns",this.addEventListener("click",e=>{e.preventDefault(),this.showColumnSelectorModal()})}static toggleSelectors(e,t,o){t.classList.add("disabled");for(let o=0;o<e.length;o++)if(!e[o].disabled&&!e[o].checked){t.classList.remove("disabled");break}o.classList.add("disabled");for(let t=0;t<e.length;t++)if(!e[t].disabled&&e[t].checked){o.classList.remove("disabled");break}}render(){return o.html`<slot></slot>`}showColumnSelectorModal(){this.url&&this.target&&s.advanced({content:this.url,title:this.title,severity:l.SeverityEnum.notice,size:s.sizes.medium,type:s.types.ajax,buttons:[{text:this.close,active:!0,btnClass:"btn-default",name:"cancel",trigger:()=>s.dismiss()},{text:this.ok,btnClass:"btn-"+c.getCssClass(l.SeverityEnum.info),name:"update",trigger:()=>this.proccessSelection(s.currentModal[0])}],ajaxCallback:()=>this.handleModalContentLoaded(s.currentModal[0])})}proccessSelection(e){const t=e.querySelector("form");null!==t?new a.default(TYPO3.settings.ajaxUrls.record_show_columns).post("",{body:new FormData(t)}).then(async e=>{const t=await e.resolve();!0===t.success?(this.ownerDocument.location.href=this.target,this.ownerDocument.location.reload(!0)):i.error(t.message||"No update was performed"),s.dismiss()}).catch(()=>{this.abortSelection()}):this.abortSelection()}handleModalContentLoaded(e){const t=e.querySelector("form");if(null===t)return;t.addEventListener("submit",e=>{e.preventDefault()});const o=e.querySelectorAll(u.columnSelectors),r=e.querySelector(u.columnSelectorActionsSelector),l=r.querySelector('button[data-action="'+p.all+'"]'),c=r.querySelector('button[data-action="'+p.none+'"]');null!==l&&null!==c&&o.length&&(d.toggleSelectors(o,l,c),o.forEach(e=>{e.addEventListener("change",()=>{d.toggleSelectors(o,l,c)})}),r.addEventListener("click",e=>{e.preventDefault();const t=e.target;if("BUTTON"===t.nodeName&&t.dataset.action){switch(t.dataset.action){case p.toggle:o.forEach(e=>{e.disabled||(e.checked=!e.checked)});break;case p.all:o.forEach(e=>{e.disabled||(e.checked=!0)});break;case p.none:o.forEach(e=>{e.disabled||(e.checked=!1)});break;default:i.warning("Unknown selector action")}d.toggleSelectors(o,l,c)}}))}abortSelection(){i.error(this.error),s.dismiss()}};__decorate([r.property({type:String})],h.prototype,"url",void 0),__decorate([r.property({type:String})],h.prototype,"target",void 0),__decorate([r.property({type:String})],h.prototype,"title",void 0),__decorate([r.property({type:String})],h.prototype,"ok",void 0),__decorate([r.property({type:String})],h.prototype,"close",void 0),__decorate([r.property({type:String})],h.prototype,"error",void 0),h=d=__decorate([r.customElement("typo3-recordlist-column-selector-button")],h)}));