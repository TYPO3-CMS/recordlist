/*
 * This file is part of the TYPO3 CMS project.
 *
 * It is free software; you can redistribute it and/or modify it under
 * the terms of the GNU General Public License, either version 2
 * of the License, or any later version.
 *
 * For the full copyright and license information, please read the
 * LICENSE.txt file that was distributed with this source code.
 *
 * The TYPO3 project - inspiring people to share!
 */
define(["require","exports","TYPO3/CMS/Backend/Utility/MessageUtility","jquery","TYPO3/CMS/Backend/Modal"],function(e,t,r,n,i){"use strict";return new(function(){function e(){var e=this;this.opener=null,this.thisScriptUrl="",this.mode="",this.formFieldName="",this.fieldReference="",this.fieldReferenceSlashed="",this.rte={parameters:"",configuration:""},this.irre={objectId:0},this.focusOpenerAndClose=function(){e.getParent()&&e.getParent().focus(),i.dismiss(),close()},n(function(){var t=n("body").data();e.thisScriptUrl=t.thisScriptUrl,e.mode=t.mode,e.formFieldName=t.formFieldName,e.fieldReference=t.fieldReference,e.fieldReferenceSlashed=t.fieldReferenceSlashed,e.rte.parameters=t.rteParameters,e.rte.configuration=t.rteConfiguration,e.irre.objectId=t.irreObjectId})}return e.prototype.setReferences=function(){return!!(this.getParent()&&this.getParent().content&&this.getParent().content.document.editform&&this.getParent().content.document.editform[this.formFieldName])&&(this.targetDoc=this.getParent().content.document,this.elRef=this.targetDoc.editform[this.formFieldName],!0)},e.prototype.executeFunctionByName=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];for(var i=e.split("."),o=i.pop(),s=0;s<i.length;s++)t=t[i[s]];return t[o].apply(t,r)},e.prototype.getParent=function(){return null===this.opener&&(void 0!==window.parent&&void 0!==window.parent.document.list_frame&&null!==window.parent.document.list_frame.parent.document.querySelector(".t3js-modal-iframe")?this.opener=window.parent.document.list_frame:void 0!==window.parent&&void 0!==window.parent.frames.list_frame&&null!==window.parent.frames.list_frame.parent.document.querySelector(".t3js-modal-iframe")?this.opener=window.parent.frames.list_frame:void 0!==window.frames&&void 0!==window.frames.frameElement&&null!==window.frames.frameElement&&window.frames.frameElement.classList.contains("t3js-modal-iframe")?this.opener=window.frames.frameElement.contentWindow.parent:window.opener&&(this.opener=window.opener)),this.opener},e.prototype.insertElement=function(e,t,n,i,o,s,a,d,f){if(this.irre.objectId){if(this.getParent()){var m={objectGroup:this.irre.objectId,table:e,uid:t};r.MessageUtility.send(m,this.getParent())}else alert("Error - reference to main window is not set properly!"),this.focusOpenerAndClose();return f&&this.focusOpenerAndClose(),!0}return!this.fieldReference||this.rte.parameters||this.rte.configuration?(this.getParent()&&this.getParent().content&&this.getParent().content.document.editform&&this.getParent().content.document.editform[this.formFieldName]?this.getParent().group_change("add",this.fieldReference,this.rte.parameters,this.rte.configuration,this.targetDoc.editform[this.formFieldName],this.getParent().content.document):alert("Error - reference to main window is not set properly!"),f&&this.focusOpenerAndClose()):this.addElement(i,e+"_"+t,o,f),!1},e.prototype.addElement=function(e,t,r,n){this.getParent()&&this.getParent().setFormValueFromBrowseWin?(this.getParent().setFormValueFromBrowseWin(this.fieldReference,r||t,e),n&&this.focusOpenerAndClose()):(alert("Error - reference to main window is not set properly!"),this.focusOpenerAndClose())},e}())});